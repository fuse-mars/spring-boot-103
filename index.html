<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Spring-boot-103 by fuse-mars</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Spring-boot-103</h1>
      <h2 class="project-tagline">CQRS pattern inside Spring</h2>
      <a href="https://github.com/fuse-mars/spring-boot-103" class="btn">View on GitHub</a>
      <a href="https://github.com/fuse-mars/spring-boot-103/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/fuse-mars/spring-boot-103/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h3>

<p>Two applications that fulfill the Command Query Responsibilities Segregation (CQRS) pattern implementation.</p>

<h3>
<a id="cqrs-in-simple-terms" class="anchor" href="#cqrs-in-simple-terms" aria-hidden="true"><span class="octicon octicon-link"></span></a>CQRS in simple terms</h3>

<p>CQRS stands for Command Query Responsibility Segregation. It is a design pattern that enforces the separation of actions that modify the state of an application and the actions that leave the state of the application intact.</p>

<ul>
<li>Qoute from the <a href="https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf">inventor's paper</a>: "objects are split into two objects, one containing the Commands one containing the Queries."</li>
<li>
<a href="https://en.wikipedia.org/wiki/Command%E2%80%93query_separation">Idea behind the design</a> : Asking a question should not change the answer.</li>
</ul>

<p>Two important terms here are:</p>

<ul>
<li>Command: code execution that modifies(mutate) the application's state, In java this would represent all "setter" methods.</li>
<li>Query: code execution that <strong>does not</strong> modifies(mutate) the application's state, In java this would represent all "getter" methods.</li>
</ul>

<h3>
<a id="spring-application---original-architechture" class="anchor" href="#spring-application---original-architechture" aria-hidden="true"><span class="octicon octicon-link"></span></a>Spring application - original architechture</h3>

<p>This is implemented in the <a href="http://fuse-mars.github.io/spring-boot-102">Spring Boot 102</a></p>

<h3>
<a id="spring-application---cqrs-based-architechture" class="anchor" href="#spring-application---cqrs-based-architechture" aria-hidden="true"><span class="octicon octicon-link"></span></a>Spring application - cqrs based architechture</h3>

<p>We are going to split into two, the <a href="https://github.com/fuse-mars/spring-boot-102">project</a> that we built in <a href="">spring-boot-102 tutorial</a>. One that processes commands and another that processes queries. Below is the schematic representation of what this separation looks like.</p>

<p><img src="https://raw.githubusercontent.com/fuse-mars/spring-boot-103/master/tutorial-resource/architecture-schema.png" alt="Architecture schema"></p>

<p>In the original architecture</p>

<ul>
<li>Step 1: user sends a POST request to save data</li>
<li>Step 2: application responds with the <strong>save data or data related errors</strong>
</li>
<li>Step 3: user sends a GET request to read the saved data</li>
<li>Step 4: application responds with the save data or request related errors </li>
</ul>

<p>In the CQRS based architecture</p>

<ul>
<li>Step 1: user sends a POST request to save data</li>
<li>Step 2: application responds with an <strong>ACK/NACK message</strong> saying that the POST request has been received or has been rejected.</li>
<li>Step 3: user sends a GET request to read the saved data.</li>
<li>Step 4: application responds with the save data or request related errors.</li>
</ul>

<h3>
<a id="technology" class="anchor" href="#technology" aria-hidden="true"><span class="octicon octicon-link"></span></a>Technology</h3>

<ul>
<li><a href="https://gradle.org/">Gradle</a></li>
<li><a href="http://projects.spring.io/spring-boot/">Spring Boot</a></li>
<li><a href="http://projects.spring.io/spring-data/">Spring Data</a></li>
</ul>

<h3>
<a id="step-followed" class="anchor" href="#step-followed" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step followed</h3>

<ul>
<li>Add a mysql database:  We can't use the in-memory database anymore because both applications have to access the same datastore.

<ul>
<li>Make sure you have a mysql database management server running locally, I use <a href="https://www.mamp.info/en/">MAMP</a> </li>
<li>add dependency </li>
</ul>
</li>
</ul>

<pre><code># build.gradle
# compile 'com.h2database:h2' removed
compile 'mysql:mysql-connector-java' # added
</code></pre>

<ul>
<li>add configuration values</li>
</ul>

<pre><code>touch application.properties
</code></pre>

<pre><code># content of the application.properties

spring.datasource.url=jdbc:mysql://localhost/springboot103
spring.datasource.username=spring
spring.datasource.password=spring
spring.datasource.driver-class-name=com.mysql.jdbc.Driver

spring.jpa.show-sql = true
spring.jpa.hibernate.ddl-auto = update
spring.jpa.hibernate.naming-strategy = org.hibernate.cfg.ImprovedNamingStrategy
spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.MySQL5Dialect


</code></pre>

<ul>
<li>Create a database called <code>springboot103</code>
</li>
<li>Create a user/password <code>spring/spring</code> with read write access to the just created databse</li>
</ul>

<ul>
<li>Create command handler application: 

<ul>
<li>This app is almost the same as the old application except, we disabled the all request methods except POST and DELETE,  The getters method have also been removed, and the response returned to the user is now an acknowledgment instead of the saved object.</li>
</ul>
</li>
</ul>

<pre><code>TODO add code snippets
</code></pre>

<ul>
<li>Create Query handler application: 

<ul>
<li>We have removed the setters from the object model. </li>
</ul>
</li>
</ul>

<pre><code>TODO add code snippets
</code></pre>

<h3>
<a id="other-main-usage-of-cqrs" class="anchor" href="#other-main-usage-of-cqrs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other main usage of CQRS</h3>

<ul>
<li>Event Sourcing: TODO </li>
</ul>

<h3>
<a id="resource" class="anchor" href="#resource" aria-hidden="true"><span class="octicon octicon-link"></span></a>Resource:</h3>

<ul>
<li><a href="https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf">https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf</a></li>
<li><a href="https://en.wikipedia.org/wiki/Command%E2%80%93query_separation">https://en.wikipedia.org/wiki/Command%E2%80%93query_separation</a></li>
<li><a href="https://github.com/netgloo/spring-boot-samples/blob/master/spring-boot-mysql-springdatajpa-hibernate/src/main/resources/application.properties">https://github.com/netgloo/spring-boot-samples/blob/master/spring-boot-mysql-springdatajpa-hibernate/src/main/resources/application.properties</a></li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/fuse-mars/spring-boot-103">Spring-boot-103</a> is maintained by <a href="https://github.com/fuse-mars">fuse-mars</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-68265226-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
